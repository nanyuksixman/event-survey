<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ë²¤íŠ¸ ì°¸ì—¬</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; text-align: center; padding-top: 30px; background-color: #f9f9f9; }
        .container { max-width: 400px; margin: 0 auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { color: #333; margin-bottom: 20px; }
        
        /* ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ */
        input { padding: 12px; font-size: 16px; width: 80%; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; text-align: center; }
        
        button { background-color: #4a90e2; color: white; border: none; padding: 15px 0; font-size: 18px; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        
        .code-box { background: #fff5f5; padding: 15px; border: 2px dashed #ff6b6b; border-radius: 10px; color: #ff6b6b; font-weight: bold; font-size: 24px; margin-top: 20px; display: none; }
        .step { display: none; }
        .step.active { display: block; }
    </style>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() { emailjs.init("1eClXvyi7Cegunx5J"); })(); // íšŒì›ë‹˜ Key
    </script>
</head>
<body>
    <div class="container">
        
        <div id="step1" class="step active">
            <h2>ğŸ 2026 í…Œí¬ê·¸ë£¹ ì„¤ë¬¸ì¡°ì‚¬ <br> í–‰ìš´ê¶Œ ì¶”ì²¨</h2>
            <p>ì„¤ë¬¸ì— ì°¸ì—¬í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.</p>
            <button onclick="tryLucky()" id="btnStart">ê²°ê³¼ í™•ì¸í•˜ê¸°</button>
        </div>

        <div id="step2" class="step">
            <h2 style="color:#4a90e2">ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
            <p>ê²½í’ˆ ì§€ê¸‰ì„ ìœ„í•´ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.<br>(ìµëª…ì„± ë³´ì¥ì„ ìœ„í•´ íƒ€ì¸ì—ê²Œ ê³µê°œë˜ì§€ ì•Šìœ¼ë©°, ë¶€ì •í–‰ìœ„ë¥¼ íŒë³„í•˜ê¸° ìœ„í•´ Keyê°’ì´ ë¶€ì—¬ë©ë‹ˆë‹¤.)</p>
            
            <input type="text" id="dept" placeholder="ë¶€ì„œëª… (ì˜ˆ: í…Œí¬ê·¸ë£¹)">
            <input type="text" id="name" placeholder="ì„±í•¨ (ì˜ˆ: ê¹€êµ­ë¯¼)">
            
            <button onclick="submitInfo()">ì „ì†¡í•˜ê³  ì½”ë“œ ë°›ê¸°</button>
        </div>

        <div id="step3" class="step">
            <h2>ì „ì†¡ ì¤‘...</h2>
            <p>ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ë³´ë‚´ê³  ìˆìŠµë‹ˆë‹¤.</p>
            <div style="font-size:30px;">ğŸ“¨</div>
        </div>

        <div id="step4" class="step">
            <h2 id="finalTitle"></h2>
            <div id="finalMsg"></div>
            <div id="winCode" class="code-box"></div>
        </div>
    </div>

    <script>
        // ============================================================
        // [ì„¤ì • 1] í–‰ìš´ì˜ ë¶„ (ë§¤ ì‹œê°„ 0~59ë¶„ ì¤‘ ë‹¹ì²¨ ê°€ëŠ¥í•œ ë¶„)
        // ì˜ˆ: [10, 30, 50] -> ë§¤ ì‹œê°„ 10ë¶„ëŒ€, 30ë¶„ëŒ€, 50ë¶„ëŒ€ì—ë§Œ ë‹¹ì²¨ ê°€ëŠ¥
        var luckyMinutes = [55, 56, 57, 58]; 
        
        // [ì„¤ì • 2] í™•ë¥  (í…ŒìŠ¤íŠ¸ í•  ë• 1, ë°°í¬ ì‹œ 1/30 ë¡œ ë³€ê²½!)
        //var baseWinRate = 1/30; 
        var baseWinRate = 1; 
        // ============================================================
        
        var generatedCode = "";
        var userDept = "";
        var userName = "";

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¤‘ë³µ ì°¸ì—¬ ì²´í¬
        window.onload = function() {
            if (localStorage.getItem('hasPlayed') === 'yes') {
                alert("ì´ë¯¸ ì¶”ì²¨ì— ì°¸ì—¬í•˜ì…¨ìŠµë‹ˆë‹¤. âœ‹");
                document.getElementById('step1').innerHTML = "<h2>ì°¸ì—¬ ì™„ë£Œ</h2><p>ì´ë¯¸ ì°¸ì—¬í•˜ì…¨ìŠµë‹ˆë‹¤.<br>ê°ì‚¬í•©ë‹ˆë‹¤.</p>";
            }
        }

        function tryLucky() {
            document.getElementById('btnStart').disabled = true;
            document.getElementById('btnStart').innerText = "í™•ì¸ ì¤‘...";
            
            // "ì°¸ì—¬í•¨" ë„ì¥ ì°ê¸°
            localStorage.setItem('hasPlayed', 'yes');

            setTimeout(function() {
                var currentMinute = new Date().getMinutes();
                var isLuckyTime = luckyMinutes.includes(currentMinute);
                
                // ì¶”ì²¨ (ì‹œê°„ + í™•ë¥ )
                if (isLuckyTime && Math.random() < baseWinRate) {
                    // ë‹¹ì²¨! -> ì •ë³´ ì…ë ¥ í™”ë©´ìœ¼ë¡œ ì´ë™
                    changeStep(2);
                } else {
                    // ê½ -> ì¢…ë£Œ
                    showResult("ì•„ì‰½ë„¤ìš” ğŸ˜­", "ë‹¹ì²¨ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>ì°¸ì—¬í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.", false);
                }
            }, 1000);
        }

        function submitInfo() {
            var deptInput = document.getElementById('dept').value;
            var nameInput = document.getElementById('name').value;

            if (deptInput.length < 1 || nameInput.length < 1) {
                return alert("ë¶€ì„œì™€ ì„±í•¨ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            }

            userDept = deptInput;
            userName = nameInput;

            // ì „ì†¡ ì¤‘ í™”ë©´ ë³´ì—¬ì£¼ê¸°
            changeStep(3);

            // ì½”ë“œ ìƒì„± ë° ì´ë©”ì¼ ì „ì†¡
            generatedCode = Math.random().toString(36).substr(2, 6).toUpperCase();
            
            var params = { 
                message: "ë¶€ì„œ: " + userDept + " / ì„±í•¨: " + userName + " / ì½”ë“œ: " + generatedCode 
            };
            
            emailjs.send('service_yzbru09', 'template_ynu7hlo', params)
                .then(function() {
                    // ì„±ê³µ ì‹œ ê²°ê³¼ í™”ë©´
                    showResult("ğŸ‰ ìµœì¢… ë‹¹ì²¨!", "ì¶•í•˜í•©ë‹ˆë‹¤!<br>ì•„ë˜ ì½”ë“œë¥¼ ìº¡ì²˜í•´ì„œ ë³´ê´€í•´ì£¼ì„¸ìš”.", true);
                }, function(error) {
                    // ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ í™”ë©´
                    console.log(error);
                    showResult("ì „ì†¡ ì‹¤íŒ¨", "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>í™”ë©´ì„ ìº¡ì²˜í•´ ë‹´ë‹¹ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.", false);
                    document.getElementById('winCode').innerText = "ì½”ë“œ: " + generatedCode + " (ì „ì†¡ì˜¤ë¥˜)";
                    document.getElementById('winCode').style.display = 'block';
                });
        }

        function showResult(title, msg, isWin) {
            changeStep(4);
            document.getElementById('finalTitle').innerText = title;
            document.getElementById('finalMsg').innerHTML = msg;
            if (isWin) {
                var box = document.getElementById('winCode');
                box.innerText = generatedCode;
                box.style.display = 'block';
            }
        }

        function changeStep(num) {
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            document.getElementById('step' + num).classList.add('active');
        }
    </script>
</body>
</html>
